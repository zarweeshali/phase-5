# Dapr PostgreSQL State Store Component
# [Task]: T017
# [From]: specs/001-phase5-cloud/tasks.md Â§Phase 2
#
# Per Constitution Principle I, all state interactions MUST go through Dapr.
# This component abstracts PostgreSQL behind Dapr State API.

apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: statestore
  namespace: todo-app
spec:
  type: state.postgresql
  version: v1
  metadata:
  - name: connectionString
    secretKeyRef:
      name: database-credentials
      key: connectionString
  - name: tableName
    value: "dapr_state"
  - name: metadataTableName
    value: "dapr_state_metadata"
  - name: maxOpenConns
    value: 10
  - name: maxIdleConns
    value: 5
  - name: connMaxLifetime
    value: 5m
  - name: schema
    value: "public"

---
# Schema for dapr_state table (auto-created by Dapr):
# CREATE TABLE dapr_state (
#     key TEXT PRIMARY KEY,
#     value BYTEA NOT NULL,
#     created_at TIMESTAMP DEFAULT NOW(),
#     updated_at TIMESTAMP DEFAULT NOW()
# );
